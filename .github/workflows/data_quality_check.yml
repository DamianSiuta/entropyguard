name: Data Quality Check (EntropyGuard)

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]
  workflow_dispatch:

jobs:
  data-quality:
    name: ðŸ›¡ï¸ RAG Firewall - Data Quality Check
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ðŸ›¡ï¸ Run EntropyGuard RAG Firewall
        uses: ./
        with:
          input_file: 'demo_dirty.jsonl'
          dedup_threshold: '0.85'
          min_length: '10'
          fail_on_duplicates: 'true'
          audit_log: 'audit.json'
        continue-on-error: false

      - name: ðŸ“Š Upload audit log (if available)
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: entropyguard-audit-log
          path: audit.json
          if-no-files-found: ignore

      - name: ðŸ“ˆ Summary
        if: always()
        run: |
          echo "## ðŸ›¡ï¸ EntropyGuard Data Quality Check" >> $GITHUB_STEP_SUMMARY
          if [ -f audit.json ]; then
            echo "âœ… Audit log generated: audit.json" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "### Audit Summary" >> $GITHUB_STEP_SUMMARY
            echo '```json' >> $GITHUB_STEP_SUMMARY
            head -20 audit.json >> $GITHUB_STEP_SUMMARY || echo "No issues found" >> $GITHUB_STEP_SUMMARY
            echo '```' >> $GITHUB_STEP_SUMMARY
          else
            echo "âš ï¸ No audit log generated" >> $GITHUB_STEP_SUMMARY
          fi

